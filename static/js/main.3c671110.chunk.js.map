{"version":3,"sources":["resources/mb_simplified.stl","pages/App.tsx","serviceWorker.ts","util/ReactCompass.js","pages/InteractiveVideo.tsx","index.tsx"],"names":["module","exports","VideoItem","fileName","children","startTime","videoUrl","to","ListGroupItem","action","App","Container","className","ListGroup","Row","Col","href","Button","variant","Boolean","window","location","hostname","match","ReactCompass","props","oldAngle","dir","sections","this","directionNames","length","sect","x","Math","floor","direction","newAngle","rot","ar","normalizeAngle","name","directionName","style","styleNormalizer","transform","Array","map","k","i","key","React","Component","defaultProps","microModel","angles","xAngle","yAngle","PI","zAngle","setup","p5","elem","createCanvas","parent","loadModel","model","angleMode","draw","background","scale","orbitControl","rotateX","rotateZ","InteractiveVideo","history","file","params","filePrefix","search","URLSearchParams","recordTime","parseInt","useState","csvFile","setCsvFile","resultPosition","setResultPosition","videoPlayer","useRef","get","useEffect","fetch","then","res","text","includes","Error","lines","split","header","items","numbers","Number","item","j","replace","push","console","log","catch","err","error","htmlPlayer","current","interval","setInterval","time","getCurrentTime","closest","binarySearch","arr","target","start","end","mid","abs","timestamp","clearInterval","ax","acc_x","ay","acc_y","az","acc_z","sqrt","square","num","atan","accToAngles","overflowX","md","maxWidth","ref","controls","url","theme","value","temp","max","steps","format","height","compass","ReactDOM","render","StrictMode","basename","exact","path","component","document","getElementById","navigator","serviceWorker","ready","registration","unregister","message"],"mappings":"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","file":"static/js/main.3c671110.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/mb_simplified.3227be1b.stl\";","import React, {PropsWithChildren} from 'react';\n\n\nimport {Button, Col, Container, ListGroup, ListGroupItem, Row} from \"react-bootstrap\";\nimport {Link} from \"react-router-dom\";\n\nfunction App() {\n\n    return (\n        <Container className='vh-100 d-flex justify-content-center align-items-center flex-column'>\n            <h1>Micro:Logger</h1>\n            <p className='text-center'>\n                A powerful, interactive logger for your Micro:Bit.\n            </p>\n            <b>Click an item to get started</b>\n            <ListGroup>\n                <VideoItem fileName='welcome' startTime={1603002903403} videoUrl={'https://youtu.be/tFzeVXQATA0'}>Welcome\n                    to Micro:Logger!</VideoItem>\n                <VideoItem fileName='sensors' startTime={1602918840792} videoUrl='https://youtu.be/hwPAFkCkD8w'>Exploring\n                    the sensors</VideoItem>\n                <VideoItem fileName='errors' startTime={1602920032281} videoUrl='https://youtu.be/HIJRud5PTjo'>How does\n                    the ACK and Timeout features\n                    work?</VideoItem>\n                <VideoItem fileName='errors_real' startTime={1602920032281} videoUrl='https://youtu.be/EKtGYOADuSo'>Error\n                    prevention in a real\n                    scenario</VideoItem>\n                <VideoItem fileName='micro_code' startTime={1602920032281} videoUrl='https://youtu.be/dEbN2fJS_bU'>A\n                    look into the Micro:bit's code</VideoItem>\n                <VideoItem fileName='pc_code' startTime={1602997561068} videoUrl='https://youtu.be/eIw1nj0tlAM'>A look\n                    into the PC's code</VideoItem>\n                <VideoItem fileName='web_code' startTime={1602920032281} videoUrl='https://youtu.be/bp_MS6-q8Vs'>A look\n                    into the Website's code</VideoItem>\n\n            </ListGroup>\n            <h3 className='mt-5 text-center'>Control the Micro:Bit connected to this PC</h3>\n            <Row>\n                <Col><a href='/restart'><Button variant='dark'>Restart</Button></a></Col>\n                <Col><a href='/reset'><Button variant='warning'>Reset</Button></a></Col>\n                <Col><a href='/stop'><Button variant='danger'>Stop</Button></a></Col>\n            </Row>\n\n        </Container>\n    );\n}\n\nfunction VideoItem({fileName, children, startTime, videoUrl}: PropsWithChildren<{ startTime: number, fileName: string, videoUrl?: string }>) {\n\n    return <Link to={`/file/${fileName}/${startTime}${videoUrl ? `?videoUrl=${videoUrl}` : ''}`}><ListGroupItem\n        action>{children}</ListGroupItem></Link>\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","/**\r\n * ReactCompass - a carefully crafted Compass component for React.\r\n * https://github.com/virtyaluk/react-compass\r\n *\r\n * Copyright (c) 2016 Bohdan Shtepan\r\n * http://modern-dev.com/\r\n *\r\n * Licensed under the MIT license.\r\n *\r\n * @flow\r\n */\r\n\r\nimport React from 'react';\r\nimport styleNormalizer from 'react-style-normalizer';\r\nimport 'react-compass/src/styles.scss';\r\n\r\nexport default class ReactCompass extends React.Component {\r\n    static defaultProps = {\r\n        direction: 0,\r\n        directionNames: ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW']\r\n    };\r\n\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.oldAngle = 0;\r\n\r\n    }\r\n\r\n    directionName(dir) {\r\n        let sections = this.props.directionNames.length,\r\n            sect = 360 / sections,\r\n            x = Math.floor((dir + sect / 2) / sect);\r\n\r\n        x = x >= sections ? 0 : x;\r\n\r\n        return this.props.directionNames[x];\r\n    }\r\n\r\n    normalizeAngle(direction) {\r\n        let newAngle = direction,\r\n            rot = this.oldAngle || 0,\r\n            ar = rot % 360;\r\n\r\n        while (newAngle < 0) {\r\n            newAngle += 360;\r\n        }\r\n        while (newAngle > 360) {\r\n            newAngle -= 360;\r\n        }\r\n        while (rot < 0) {\r\n            rot += 360;\r\n        }\r\n        while (rot > 360) {\r\n            rot -= 360;\r\n        }\r\n\r\n        if (ar < 0) {\r\n            ar += 360;\r\n        }\r\n        if (ar < 180 && newAngle > ar + 180) {\r\n            rot -= 360;\r\n        }\r\n        if (ar >= 180 && newAngle <= ar - 180) {\r\n            rot += 360;\r\n        }\r\n\r\n        rot += newAngle - ar;\r\n        this.oldAngle = rot;\r\n\r\n        return rot;\r\n    }\r\n\r\n    render() {\r\n        let dir = this.normalizeAngle(this.props.direction),\r\n            name = this.directionName(dir);\r\n\r\n        return (\r\n            <div className=\"compass\" style={this.props.style}>\r\n                <div className=\"compass__windrose\"\r\n                     style={styleNormalizer({transform: `rotate(-${this.props.direction}deg)`})}>\r\n                    {[...Array(10)].map((k, i) => <div className=\"compass__mark\" key={i + 1}></div>)}\r\n                    <div className=\"compass__mark--direction-h\"></div>\r\n                    <div className=\"compass__mark--direction-v\"></div>\r\n                </div>\r\n                <div className=\"compass__arrow-container\">\r\n                    <div className=\"compass__arrow\"></div>\r\n                    <div className=\"compass__labels\">\r\n                        <span>{name}</span>\r\n                        <span>{dir}<sup>o</sup></span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import React, {useEffect, useRef, useState} from 'react';\r\nimport {Link, RouteChildrenProps} from \"react-router-dom\";\r\nimport Sketch from \"react-p5\";\r\nimport p5Types from 'p5';\r\nimport model from '../resources/mb_simplified.stl'\r\nimport {Button, Col, Container, Row} from \"react-bootstrap\";\r\n\r\nimport Thermometer from 'react-thermometer-component'\r\nimport Compass from '../util/ReactCompass';\r\nimport ReactPlayer from \"react-player\";\r\n\r\n// p5js real-time model\r\nlet microModel: p5Types.Geometry;\r\nlet angles: Angles = {xAngle: 0, yAngle: Math.PI / 2, zAngle: 0};\r\nconst setup = (p5: p5Types, elem: Element) => {\r\n    p5.createCanvas(500, 500, \"webgl\").parent(elem)\r\n    microModel = p5.loadModel(model);\r\n    p5.angleMode('radians');\r\n}\r\nconst draw = (p5: p5Types) => {\r\n    p5.background('#000000');\r\n    p5.scale(85)\r\n    p5.orbitControl()\r\n    // z is x angle\r\n    // x is y angle\r\n    // y is z angle\r\n    // flip Y dimension, model is flipped.\r\n    p5.rotateX(Math.PI);\r\n    p5.rotateZ(-angles.xAngle);\r\n    p5.rotateX(-angles.yAngle);\r\n    // p5.rotateY(angles.zAngle)\r\n    p5.model(microModel)\r\n}\r\n\r\ntype CSVObject = {\r\n    timestamp: number;\r\n    time_took: number;\r\n    acc_x: number;\r\n    acc_y: number;\r\n    acc_z: number;\r\n    temp: number;\r\n    compass: number;\r\n}\r\ntype Angles = {\r\n    xAngle: number;\r\n    yAngle: number;\r\n    zAngle: number;\r\n\r\n}\r\n\r\nfunction InteractiveVideo({match, history, location}: RouteChildrenProps<{ filePrefix: string, recordTime: string }>) {\r\n    const file = match?.params?.filePrefix;\r\n    const search = new URLSearchParams(location.search);\r\n    const recordTime = parseInt(match?.params?.recordTime || '');\r\n\r\n    const [csvFile, setCsvFile] = useState<CSVObject[]>([]);\r\n    const [resultPosition, setResultPosition] = useState<CSVObject>();\r\n    const videoPlayer = useRef<ReactPlayer>();\r\n    const videoUrl = search.get('videoUrl') || `videos/${file}.mp4`;\r\n\r\n\r\n    // load file\r\n    useEffect(() => {\r\n        fetch(`videos/${file}.csv`).then((res) => res.text())\r\n            .then(res => {\r\n                if (res.includes('html'))\r\n                    throw new Error(\"Not found\")\r\n                const lines = res.split('\\n');\r\n                const header = lines[0].split(',')\r\n                const items: CSVObject[] = []\r\n                // ignore first and last item (header and newline)\r\n                for (let i = 1; i < lines.length - 1; i++) {\r\n                    const numbers = lines[i].split(',').map(Number);\r\n                    const item: any = {}\r\n                    for (let j = 0; j < header.length; j++) {\r\n                        item[header[j].replace(/[\\n\\r]/g, '')] = numbers[j];\r\n                    }\r\n                    items.push(item as CSVObject);\r\n\r\n                }\r\n\r\n                console.log(items);\r\n                setCsvFile(items)\r\n            })\r\n            .catch(err => {\r\n                console.error(err)\r\n                history.push('/404')\r\n            })\r\n    }, [file, history])\r\n\r\n    // calculate position in video for meters to update\r\n    const htmlPlayer = videoPlayer?.current;\r\n    useEffect(() => {\r\n        if (!htmlPlayer)\r\n            return;\r\n\r\n        const onVidPlay = () => {\r\n            if (csvFile.length === 0)\r\n                return;\r\n            const time = htmlPlayer.getCurrentTime() * 1000 + recordTime;\r\n            const closest = binarySearch(csvFile, time);\r\n            setResultPosition(closest);\r\n\r\n        }\r\n        const interval = setInterval(onVidPlay, 100);\r\n        // htmlPlayer.addEventListener('timeupdate', onVidPlay)\r\n        return () => {\r\n            clearInterval(interval);\r\n            // htmlPlayer.removeEventListener(\"timeupdate\", onVidPlay);\r\n        };\r\n\r\n    }, [csvFile, htmlPlayer, recordTime]);\r\n    // update p5 model\r\n    useEffect(() => {\r\n        if (resultPosition)\r\n            angles = accToAngles(resultPosition);\r\n    }, [resultPosition])\r\n\r\n    if (!file || !recordTime)\r\n        history.push('/404')\r\n\r\n\r\n    return (\r\n        <Container style={{overflowX: 'hidden'}}>\r\n\r\n            <Row className='m-5 ml-1'><Link to='/'><Button>Go Back Home</Button></Link>\r\n                <a href={`videos/${file}.csv`}><Button variant='success' className='ml-3'>Download CSV</Button></a>\r\n            </Row>\r\n            <Row>\r\n                <Col md={6}>\r\n                    <Sketch setup={setup} draw={draw} style={{maxWidth: '100%'}}/>\r\n                </Col>\r\n                <Col md={6}>\r\n                    <ReactPlayer ref={videoPlayer as any /* Bug with useRef typing*/} controls={true}\r\n                                 url={videoUrl}\r\n                                 style={{maxWidth: '100%'}}/>\r\n                </Col>\r\n            </Row>\r\n            <Row className='mt-4'>\r\n                <Col md={6} className='d-flex align-items-center justify-content-center'>\r\n                    <Thermometer theme=\"light\"\r\n                                 value={resultPosition?.temp}\r\n                                 max=\"100\"\r\n                                 steps=\"3\"\r\n                                 format=\"Â°C\"\r\n                                 height=\"300\"/>\r\n\r\n\r\n                </Col>\r\n                <Col md={6}><Compass direction={resultPosition?.compass} style={{transform: 'scale(0.5)'}}/></Col>\r\n            </Row>\r\n        </Container>\r\n    );\r\n}\r\n\r\n/**\r\n * A modified binary search algorithm to find the closest csv result to match the time.\r\n * Sourced: https://www.geeksforgeeks.org/binary-search-in-javascript/\r\n * Modified to support closest value instead.\r\n */\r\nfunction binarySearch(arr: CSVObject[], target: number, start: number = 0, end: number = arr.length - 1): CSVObject {\r\n    // Base Condition\r\n    if (start > end) throw Error(\"Unexpected case!\");\r\n\r\n    // Find the middle index\r\n    let mid = Math.floor((start + end) / 2);\r\n\r\n\r\n    // if difference is just one, get the closest between them two\r\n    if (Math.abs(start - end) <= 1) {\r\n        if (Math.abs(arr[start].timestamp - target) < Math.abs(arr[end].timestamp - target)) {\r\n            return arr[start];\r\n        } else {\r\n            return arr[end];\r\n        }\r\n    }\r\n\r\n    // If element at mid is greater than x,\r\n    // search in the left half of mid\r\n    if (arr[mid].timestamp > target)\r\n        return binarySearch(arr, target, start, mid - 1);\r\n    else\r\n        // If element at mid is smaller than x,\r\n        // search in the right half of mid\r\n        return binarySearch(arr, target, mid + 1, end);\r\n}\r\n\r\n/**\r\n * Acceleration values to angles, in radians\r\n * Sourced from:\r\n * http://wizmoz.blogspot.com/2013/01/simple-accelerometer-data-conversion-to.html\r\n * If this algorithm fails, backup: https://wiki.dfrobot.com/How_to_Use_a_Three-Axis_Accelerometer_for_Tilt_Sensing\r\n */\r\nfunction accToAngles(res: CSVObject): Angles {\r\n    const {acc_x: ax, acc_y: ay, acc_z: az} = res;\r\n    const sqrt = Math.sqrt;\r\n    const square = (num: number) => num * num;\r\n\r\n    let xAngle = Math.atan(ax / (sqrt(square(ay) + square(az))));\r\n    let yAngle = Math.atan(ay / (sqrt(square(ax) + square(az))));\r\n    // Never used let zAngle = Math.atan(sqrt(square(ax) + square(ay)) / az);\r\n\r\n    return {xAngle, yAngle, zAngle: 0};\r\n}\r\n\r\nexport default InteractiveVideo;","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './pages/App';\r\nimport * as serviceWorker from './serviceWorker';\r\nimport {HashRouter, Redirect, Route, Switch} from 'react-router-dom'\r\nimport InteractiveVideo from \"./pages/InteractiveVideo\";\r\nimport './scss/index.scss'\r\nimport 'bootstrap/scss/bootstrap.scss'\r\n\r\nReactDOM.render(\r\n    <React.StrictMode>\r\n        <HashRouter basename='/'>\r\n            <Switch>\r\n                <Route exact path='/' component={App}/>\r\n                <Route path='/file/:filePrefix/:recordTime' component={InteractiveVideo}/>\r\n                <Route path='/404'><h1>404 Not Found</h1></Route>\r\n                <Redirect to='/404'/>\r\n            </Switch>\r\n        </HashRouter>\r\n    </React.StrictMode>,\r\n    document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}